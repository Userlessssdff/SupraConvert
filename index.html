<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraConvert | Image Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            /* --- Palette: Modern Violet/Indigo --- */
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --primary-light: #e0e7ff;
            --secondary: #f8fafc;
            --surface: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;

            /* --- Status --- */
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;

            /* --- Smoothing & Physics --- */
            --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --duration: 0.4s;

            /* --- Depth --- */
            --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            --glass: rgba(255, 255, 255, 0.8);
        }

        /* --- Global Reset --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f1f5f9;
            background-image:
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(16, 185, 129, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        a { text-decoration: none; color: inherit; transition: color var(--duration) var(--ease-smooth); }
        ul { margin: 0; padding-left: 1.2rem; }
        li { margin-bottom: 0.5rem; }

        /* --- Layout Container --- */
        #app-frame {
            width: 100%;
            max-width: 1000px;
            margin: 2rem 1rem;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.6);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 80vh;
            position: relative;
        }

        /* --- Smooth Header --- */
        .app-header {
            padding: 1.5rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.5);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .brand span { color: var(--primary); }

        .nav-pills {
            display: flex;
            background: var(--secondary);
            padding: 0.3rem;
            border-radius: 99px;
            border: 1px solid var(--border);
        }

        .nav-item {
            padding: 0.6rem 1.5rem;
            border-radius: 99px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
        }
        .nav-item:hover { color: var(--text-main); }
        .nav-item.active {
            background: #fff;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        /* --- Animated Views --- */
        main { flex: 1; padding: 3rem; position: relative; }

        .view-section {
            /* Smooth Fade In/Out Logic */
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            position: absolute;
            top: 3rem;
            left: 3rem; right: 3rem;
            transition: opacity 0.4s ease, transform 0.4s var(--ease-out-back);
        }

        .view-section.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
            position: relative;
            top: 0; left: 0; right: 0;
        }

        /* --- Components: Typography --- */
        h1 { font-size: 2.5rem; font-weight: 800; letter-spacing: -0.04em; margin-bottom: 0.5rem; background: linear-gradient(135deg, #1e293b 0%, #6366f1 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { font-size: 1.8rem; font-weight: 700; margin-bottom: 1.5rem; color: var(--text-main); }
        h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-main); margin-top: 1.5rem;}
        h4 { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-main); margin-top: 1rem;}
        p { line-height: 1.7; color: var(--text-muted); margin-bottom: 1rem; }

        /* --- Component: Dropzone --- */
        .dropzone-container {
            border: 3px dashed var(--border);
            border-radius: 24px;
            background: linear-gradient(to bottom, #fcfcfc, #f1f5f9);
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-back);
            position: relative;
            overflow: hidden;
        }
        .dropzone-container:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        .dropzone-container.drag-over {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: scale(1.02);
        }
        .drop-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: inline-block;
            filter: drop-shadow(0 4px 6px rgba(99, 102, 241, 0.3));
            transition: transform 0.4s var(--ease-out-back);
        }
        .dropzone-container:hover .drop-icon { transform: scale(1.1) rotate(5deg); }

        /* --- Component: Info Cards (Policy/Contact) --- */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .info-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.3s var(--ease-smooth);
        }
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        .icon-badge {
            width: 48px; height: 48px;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        /* NEW: Checkbox Style */
        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-main);
        }
        .checkbox-container input[type="checkbox"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 6px;
            margin-right: 10px;
            outline: none;
            cursor: pointer;
            position: relative;
            transition: all 0.2s var(--ease-smooth);
        }
        .checkbox-container input[type="checkbox"]:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        .checkbox-container input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
        }


        /* --- Component: Inputs & Selects --- */
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            background: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
            margin-bottom: 1rem;
        }
        .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 4px var(--primary-light); }

        /* --- Component: Collapsible Settings --- */
        .settings-accordion {
            border: 1px solid var(--border);
            border-radius: 16px;
            background: #fff;
            overflow: hidden;
            margin-bottom: 1rem;
            transition: box-shadow 0.3s;
        }
        .accordion-head {
            padding: 1rem 1.5rem;
            background: #fafafa;
            cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 600;
            transition: background 0.2s;
        }
        .accordion-head:hover { background: #f1f5f9; }
        .accordion-body {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.5s var(--ease-smooth);
            background: #fff;
        }
        .accordion-body.open {
            max-height: 800px;
            opacity: 1;
            padding: 1.5rem;
            border-top: 1px solid var(--border);
        }
        .chevron { transition: transform 0.3s; }
        .settings-accordion.active .chevron { transform: rotate(180deg); }

        /* --- Component: Buttons --- */
        .btn {
            display: inline-flex; justify-content: center; align-items: center;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s var(--ease-out-back);
            gap: 0.5rem;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary {
            background: var(--primary); color: #fff;
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.39);
        }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.23); }
        .btn-primary:disabled { background: var(--text-muted); cursor: not-allowed; transform: none; }

        .btn-secondary { background: var(--secondary); color: var(--text-main); border: 1px solid var(--border); }
        .btn-secondary:hover { background: #e2e8f0; }

        /* --- Component: Progress Bar --- */
        .progress-track {
            height: 12px; background: var(--border);
            border-radius: 99px; overflow: hidden; margin: 2rem 0;
        }
        .progress-fill {
            height: 100%; width: 0%;
            background: var(--primary);
            border-radius: 99px;
            transition: width 0.5s ease-out;
            background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
            background-size: 1rem 1rem;
            animation: stripe-move 1s linear infinite;
        }
        @keyframes stripe-move { from { background-position: 1rem 0; } to { background-position: 0 0; } }

        /* Removed Comparison Slider Styles */

        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.85rem;
            background: rgba(255,255,255,0.3);
        }

        /* Mobile Tweaks */
        @media (max-width: 600px) {
            .app-header { flex-direction: column; gap: 1rem; padding: 1rem; }
            main { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            .nav-pills { flex-wrap: wrap; justify-content: center; }
            /* .comp-container { height: 300px; } - Removed */
        }
    </style>
</head>
<body>

    <div id="app-frame">
        <header class="app-header">
            <div class="brand" onclick="switchView('home')">
                <span>‚ö°</span> UltraConvert
            </div>
            <nav class="nav-pills">
                <div class="nav-item active" onclick="switchView('home')" id="nav-home">Converter</div>
                <div class="nav-item" onclick="switchView('policy')" id="nav-policy">Policy</div>
                <div class="nav-item" onclick="switchView('terms')" id="nav-terms">Terms</div>
                <div class="nav-item" onclick="switchView('about')" id="nav-about">About</div>
            </nav>
        </header>

        <main>
            <section id="view-home" class="view-section active">
                <div id="state-upload-conv">
                    <div style="text-align: center; margin-bottom: 3rem;">
                        <h1>Make Images Better.</h1>
                        <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto;">
                            The professional, privacy-first image tool. Convert formats, resize dimensions, and compress file sizes instantly on your local secure server.
                        </p>
                    </div>

                    <input type="file" id="file-input-conv" hidden accept="image/*">
                    <div id="dropzone-conv" class="dropzone-container">
                        <span class="drop-icon">üñºÔ∏è</span>
                        <h3>Drag & Drop your Image</h3>
                        <p>Supports JPG, PNG, WebP, GIF, TIFF, BMP, ICO + Modern Formats</p>
                        <button class="btn btn-secondary" style="margin-top: 1rem;">Browse Files</button>
                    </div>
                </div>

                <div id="state-config-conv" class="hidden" style="display: none;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; background: #fff; padding: 1rem; border-radius: 12px; border: 1px solid var(--border);">
                        <div>
                            <h4>File Ready: <span id="file-name-conv" style="color: var(--primary);"></span></h4>
                            <p style="margin: 0; font-size: 0.9rem;">Size: <span id="file-size-conv"></span></p>
                        </div>
                        <button onclick="resetApp()" class="btn btn-secondary" style="padding: 0.5rem 1rem;">Change File</button>
                    </div>

                    <h3 style="margin-bottom: 0.5rem;">1. Select Output Format</h3>
                    <select id="format-select" class="form-control">
                        </select>

                    <div class="settings-accordion" id="acc-resize">
                        <div class="accordion-head" onclick="toggleAccordion('acc-resize')">
                            <span>üìê Resizing & Dimensions</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <h4>New Dimensions (Pixels)</h4>
                            <div style="display: flex; gap: 1rem;">
                                <input type="number" id="inp-width" placeholder="Width (optional)" class="form-control">
                                <input type="number" id="inp-height" placeholder="Height (optional)" class="form-control">
                            </div>
                            <label class="checkbox-container" style="margin-bottom: 1.5rem;">
                                <input type="checkbox" id="check-ar" checked>
                                Maintain Aspect Ratio
                            </label>
                            
                            <h4>Resize Quality (Interpolation)</h4>
                            <select id="resample-filter" class="form-control">
                                <option value="lanczos">High Quality (Lanczos - Default)</option>
                                <option value="bicubic">Bicubic (Good Quality)</option>
                                <option value="bilinear">Bilinear (Fast)</option>
                                <option value="nearest">Nearest Neighbor (Fastest, Poor Quality)</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-accordion" id="acc-transform">
                        <div class="accordion-head" onclick="toggleAccordion('acc-transform')">
                            <span>üîÑ Rotate & Flip</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <h4>Rotation</h4>
                            <select id="inp-rotation" class="form-control">
                                <option value="0">No Rotation</option>
                                <option value="90">Rotate 90¬∞ Clockwise</option>
                                <option value="180">Rotate 180¬∞</option>
                                <option value="270">Rotate 270¬∞ Clockwise</option>
                            </select>

                            <h4>Flip</h4>
                            <select id="inp-flip" class="form-control">
                                <option value="none">No Flip</option>
                                <option value="horizontal">Horizontal Flip (Mirror)</option>
                                <option value="vertical">Vertical Flip</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-accordion" id="acc-enhance">
                        <div class="accordion-head" onclick="toggleAccordion('acc-enhance')">
                            <span>üé® Color & Enhancement</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <label class="checkbox-container" style="display: block; margin-bottom: 1rem;">
                                <input type="checkbox" id="check-grayscale">
                                Convert to Grayscale (Black & White)
                            </label>

                            <h4 style="margin-top: 1.5rem;">Brightness</h4>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Level</span> <span style="font-weight: 700; color: var(--primary);" id="brightness-disp">100%</span>
                            </div>
                            <input type="range" id="inp-brightness" min="0" max="200" value="100" oninput="document.getElementById('brightness-disp').textContent = this.value + '%'" style="width: 100%; accent-color: var(--primary);">

                            <h4 style="margin-top: 1.5rem;">Contrast</h4>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Level</span> <span style="font-weight: 700; color: var(--primary);" id="contrast-disp">100%</span>
                            </div>
                            <input type="range" id="inp-contrast" min="0" max="200" value="100" oninput="document.getElementById('contrast-disp').textContent = this.value + '%'" style="width: 100%; accent-color: var(--primary);">

                            <h4 style="margin-top: 1.5rem;">Sharpness</h4>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Level</span> <span style="font-weight: 700; color: var(--primary);" id="sharpness-disp">100%</span>
                            </div>
                            <input type="range" id="inp-sharpness" min="0" max="200" value="100" oninput="document.getElementById('sharpness-disp').textContent = this.value + '%'" style="width: 100%; accent-color: var(--primary);">
                        </div>
                    </div>

                    <div class="settings-accordion" id="acc-quality">
                        <div class="accordion-head" onclick="toggleAccordion('acc-quality')">
                            <span>üìà Quality / Compression</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <p style="margin-bottom: 1.5rem;">
                                Adjust quality for lossy formats (JPEG, WebP, TIFF, AVIF, JXL, HEIF). Higher quality means bigger file size.
                            </p>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Quality Level</span> <span style="font-weight: 700; color: var(--primary);" id="quality-disp">95%</span>
                            </div>
                            <input type="range" id="inp-quality" min="1" max="100" value="95" oninput="document.getElementById('quality-disp').textContent = this.value + '%'" style="width: 100%; accent-color: var(--primary);">
                            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                <span>Low (Small Size)</span> <span>High (Best Look)</span>
                            </div>
                        </div>
                    </div>

                    <div class="settings-accordion" id="acc-opacity">
                        <div class="accordion-head" onclick="toggleAccordion('acc-opacity')">
                            <span>üíß Transparency / Opacity</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Opacity Level</span> <span style="font-weight: 700; color: var(--primary);" id="opacity-disp">100%</span>
                            </div>
                            <input type="range" id="inp-opacity" min="0" max="100" value="100" oninput="document.getElementById('opacity-disp').textContent = this.value + '%'" style="width: 100%; accent-color: var(--primary);">
                            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                <span>Transparent (Invisible)</span> <span>Opaque (Solid)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-accordion" id="acc-format-specific">
                        <div class="accordion-head" onclick="toggleAccordion('acc-format-specific')">
                            <span>‚öôÔ∏è Format Specific Options</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <div id="format-options-container">
                                <p>Select a format above to see specific options here.</p>
                            </div>
                        </div>
                    </div>

                    <button onclick="startJob('convert')" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem; padding: 1.2rem;">
                        üöÄ Start Conversion
                    </button>
                </div>
            </section>

            <div id="state-result" class="view-section" style="display: none; text-align: center; padding-top: 2rem;">
                <h2 id="status-head">Processing Image...</h2>
                <div class="progress-track">
                    <div id="progress-bar" class="progress-fill"></div>
                </div>
                <p id="status-text">Uploading to secure environment...</p>

                <div id="preview-area" style="display: none; max-width: 600px; margin: 2rem auto;">
                    <img class="preview-img" style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: var(--shadow-lg);">
                </div>

                <div id="final-actions" style="display: none; margin-top: 2rem;">
                    </div>
            </div>

            <section id="view-policy" class="view-section">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>Privacy Policy</h1>
                    <p>Last Updated: <script>document.write(new Date().toLocaleDateString())</script></p>
                </div>
                <div class="info-card" style="max-width: 900px; margin: 0 auto;">
                    <h3>1. Information We Collect</h3>
                    <p>We may collect the following types of data:</p>
                    <h4>A. Automatically Collected Data</h4>
                    <p>When you visit our site, we automatically collect:</p>
                    <ul>
                        <li>IP address (for rate limiting and security)</li>
                        <li>Browser type and version</li>
                        <li>Device information</li>
                    </ul>
                    <h4>B. Information You Provide Voluntarily</h4>
                    <ul>
                        <li>**Uploaded Files:** All files uploaded for processing are stored temporarily on the server (max 30 minutes, see Cleanup Policy) and are immediately deleted after the resulting file is downloaded or the job expires. We do not inspect, retain, or share your image content.</li>
                        <li>Form submissions (e.g., contact form)</li>
                    </ul>
                    
                    <h3>2. Data Retention & Deletion</h3>
                    <p>All uploaded source images and processed result images are automatically and permanently deleted from our servers within 30 minutes of processing completion or job failure. We do not inspect, retain, or share your image content. You must download your file within this window.</p>
                    
                    <h3>3. Third-Party Processing (AI Upscale)</h3>
                    <p>The **AI Upscale** feature sends your image data to a third-party AI model hosted via a secure API (currently Hugging Face). We are not responsible for their data handling. Use the AI feature at your own discretion. Standard conversions are processed locally.</p>
                    
                    <h3>4. Cookies and Tracking</h3>
                    <p>We use essential cookies for:</p>
                    <ul>
                        <li>Rate limiting (to ensure fair access)</li>
                        <li>Session management (to track your job status)</li>
                        <li>We do not use tracking cookies for personalized advertising.</li>
                    </ul>
                    
                    <h3>5. Children's Privacy</h3>
                    <p>Our service is not directed to individuals under the age of 13. We do not knowingly collect data from children.</p>
                    
                    <h3>6. Contact Us</h3>
                    <p>If you have any questions about this Privacy Policy, please contact us at: üìß <strong>[Your Support Email]</strong></p>
                </div>
            </section>

            <section id="view-terms" class="view-section">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>Terms of Service</h1>
                    <p>Last Updated: <script>document.write(new Date().toLocaleDateString())</script></p>
                </div>
                <div class="info-card" style="max-width: 900px; margin: 0 auto;">
                    <h3>1. Acceptance</h3>
                    <p>By accessing or using UltraConvert, you agree to be bound by these Terms of Service.</p>
                    
                    <h3>2. User Content</h3>
                    <p>You retain all ownership rights to the content you upload. You grant UltraConvert a temporary, worldwide, non-exclusive license to process, resize, convert, and output your files solely for the purpose of providing the service you requested. This license terminates automatically when the files are deleted from the server (max 30 minutes).</p>
                    
                    <h3>3. Restrictions</h3>
                    <p>You must not upload or process any content that is illegal, infringes on intellectual property rights, or is malicious. Abuse of the service, including excessive automated requests or high-volume uploads designed to strain resources, is prohibited.</p>
                    
                    <h3>4. Service Availability and Disclaimer</h3>
                    <p>The service is provided on an "AS IS" and "AS AVAILABLE" basis. We make no guarantees about service uptime or performance. We are not responsible for any data loss, file corruption, or processing errors that may occur.</p>
                    
                    <h3>5. Limitation of Liability</h3>
                    <p>UltraConvert shall not be liable for any direct, indirect, incidental, special, or consequential damages (including, without limitation, damages for loss of data or profit, or due to business interruption) arising out of the use or inability to use the service.</p>
                </div>
            </section>

            <section id="view-about" class="view-section">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>About UltraConvert</h1>
                    <p>High performance, privacy-focused image processing.</p>
                </div>
                <div class="info-card" style="margin-bottom: 2rem; max-width: 900px; margin: 0 auto;">
                    <h3>Hybrid Architecture - Explaining Everything Works</h3>
                    <p>UltraConvert uses a robust, thread-safe Python Flask backend with a responsive, modern HTML/CSS/JS frontend. The entire application is built on a **Conversion Core (Local Processing)** architecture. Standard conversions (JPG, PNG, WebP, etc.) and all advanced features (Resize, Rotate, Color Adjustments, Quality) are handled locally on the secure server using the **Python Pillow** library. This is fast, thread-safe, and keeps your data private on the server for the brief retention period.</p>
                    
                    <h3>Smoothness and Performance</h3>
                    <p>The user interface employs pure JavaScript and CSS (using advanced `cubic-bezier` timing functions like `var(--ease-smooth)`) to deliver silky smooth transitions and animations. The backend uses a `ThreadPoolExecutor` and `JOB_LOCK` to manage **concurrent user jobs** without blocking the main application (asynchronous processing), resulting in a fast and non-stuttering experience for all users.</p>
                    
                    <h3>New Features in this Release!</h3>
                    <p>This version includes **22** major new features, including advanced color correction, transformations, interpolation controls, and new modern output formats like AVIF and JXL.</p>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; <script>document.write(new Date().getFullYear())</script> UltraConvert. Built with Python & Pillow.</p>
        </footer>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let FILE = null;
        let FILE_URL = null;
        let TIMER = null;
        let CONVERSIONS = {};
        let startTime = 0;
        const featureCount = 22;

        // --- CORE LOGIC ---

        // Function to switch between views
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(`view-${viewId}`).classList.add('active');
            document.getElementById(`nav-${viewId}`).classList.add('active');

            // Scroll to the top of the main container smoothly
            const mainContent = document.querySelector('main');
            mainContent.scrollTop = 0;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Removed: moveSlider function

        // --- UI INTERACTION ---

        function toggleAccordion(id) {
            const acc = document.getElementById(id);
            const body = acc.querySelector('.accordion-body');
            const wasOpen = acc.classList.contains('active');
            
            // Close all other accordions for a cleaner look
            document.querySelectorAll('.settings-accordion').forEach(a => {
                a.classList.remove('active');
                a.querySelector('.accordion-body').classList.remove('open');
            });
            
            // Open the clicked one if it was closed
            if (!wasOpen) {
                acc.classList.add('active');
                body.classList.add('open');
            }
        }

        function showState(mode, stateSuffix) {
            // Only 'conv' mode remains
            document.getElementById('state-upload-conv').style.display = 'none';
            document.getElementById('state-config-conv').style.display = 'none';
            
            if(stateSuffix === 'result') {
                 triggerResultView();
            } else {
                document.getElementById(`state-${stateSuffix}-${mode}`).style.display = 'block';
                document.getElementById('state-result').style.display = 'none';
            }
        }

        function triggerResultView() {
            document.getElementById('state-config-conv').style.display = 'none';
            // Removed: document.getElementById('state-config-up').style.display = 'none';
            const res = document.getElementById('state-result');
            
            // Reset transition for smooth re-entry
            res.style.transition = 'none'; 
            res.style.display = 'block';
            res.style.opacity = '0';
            res.style.transform = 'translateY(10px)';
            
            setTimeout(() => { 
                res.style.transition = 'all 0.4s ease-out';
                res.style.opacity = '1';
                res.style.transform = 'translateY(0)';
            }, 10);
        }

        // NEW: Dynamically updates format-specific options (No change to this logic)
        function updateFormatOptions(conversion_key) {
            const details = CONVERSIONS[conversion_key];
            const container = document.getElementById('format-options-container');
            container.innerHTML = '';

            if (!details) {
                container.innerHTML = '<p>Select a format above to see specific options here.</p>';
                return;
            }

            let html = `<h4>Format-Specific Options for ${details.name}</h4>`;

            // PNG Specific (Feature 4: Optimization)
            if (details.format === 'PNG') {
                html += `
                    <label class="checkbox-container" style="display: block; margin-top: 1rem;">
                        <input type="checkbox" id="check-optimize-png" checked>
                        Optimize PNG Size (Slower, smaller file)
                    </label>
                `;
            }

            // JPEG Specific (Feature 5: Progressive)
            if (details.format === 'JPEG') {
                html += `
                    <label class="checkbox-container" style="display: block; margin-top: 1rem;">
                        <input type="checkbox" id="check-progressive-jpeg">
                        Progressive JPEG (Better display on slow connections)
                    </label>
                `;
            }
            
            // WebP Specific (Feature 21: Lossless)
            if (details.format === 'WEBP') {
                html += `
                    <label class="checkbox-container" style="display: block; margin-top: 1rem;">
                        <input type="checkbox" id="check-webp-lossless">
                        Lossless WebP (Higher quality, larger file)
                    </label>
                `;
            }

            // AVIF/JXL/HEIF Specific (Features 16, 17, 18: Modern Lossless/Lossy Toggle)
            if (['AVIF', 'JXL', 'HEIF'].includes(details.format)) {
                html += `
                    <label class="checkbox-container" style="display: block; margin-top: 1rem;">
                        <input type="checkbox" id="check-lossless-modern">
                        Lossless Mode (Best Quality, Slower Processing)
                    </label>
                    <p style="font-size:0.9rem; color: var(--text-muted); margin-top: 0.5rem;">If unchecked, a lossy compression will be used with the quality setting above.</p>
                `;
            }

            if (html === `<h4>Format-Specific Options for ${details.name}</h4>`) {
                container.innerHTML = '<p>No additional format-specific options for this format.</p>';
            } else {
                container.innerHTML = html;
            }
        }

        function populateSelect() {
            const select = document.getElementById('format-select');
            select.innerHTML = '';
            
            // Filter out 'ai_upscale' and sort
            const sortedConversions = Object.entries(CONVERSIONS)
                .filter(([key, details]) => key !== 'ai_upscale')
                .sort(([, a], [, b]) => a.name.localeCompare(b.name));

            for (const [key, details] of sortedConversions) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = details.name;
                select.appendChild(option);
            }
            
            select.onchange = (e) => updateFormatOptions(e.target.value);
            
            if (sortedConversions.length > 0) {
                updateFormatOptions(sortedConversions[0][0]);
            }
        }

        // --- FILE HANDLING (Updated to remove upscale path) ---

        function handleFile(f) { // Removed 'mode' parameter
            if (!f.type.startsWith('image/')) throw new Error("Only images are supported, please.");
            FILE = f;
            FILE_URL = URL.createObjectURL(f);
            const sizeStr = (f.size / (1024*1024)).toFixed(2) + " MB";

            document.getElementById('file-name-conv').textContent = f.name;
            document.getElementById('file-size-conv').textContent = sizeStr;
            showState('conv', 'config');
        }

        function setupEvents() {
            // Converter dropzone
            const dropzoneConv = document.getElementById('dropzone-conv');
            const fileInputConv = document.getElementById('file-input-conv');
            
            dropzoneConv.onclick = () => fileInputConv.click();
            fileInputConv.onchange = (e) => {
                if(e.target.files.length) handleFile(e.target.files[0]);
            };
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropzoneConv.addEventListener(eventName, (e) => {
                    e.preventDefault(); e.stopPropagation();
                    if(eventName === 'dragenter' || eventName === 'dragover') {
                        dropzoneConv.classList.add('drag-over');
                    } else if (eventName === 'dragleave') {
                        dropzoneConv.classList.remove('drag-over');
                    } else if (eventName === 'drop') {
                        dropzoneConv.classList.remove('drag-over');
                        if(e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
                    }
                }, false);
            });
            
            // Removed: Upscale dropzone setup

            // Initialize enhancement sliders
            document.getElementById('inp-brightness').oninput = (e) => document.getElementById('brightness-disp').textContent = e.target.value + '%';
            document.getElementById('inp-contrast').oninput = (e) => document.getElementById('contrast-disp').textContent = e.target.value + '%';
            document.getElementById('inp-sharpness').oninput = (e) => document.getElementById('sharpness-disp').textContent = e.target.value + '%';
            document.getElementById('inp-quality').oninput = (e) => document.getElementById('quality-disp').textContent = e.target.value + '%';
            document.getElementById('inp-opacity').oninput = (e) => document.getElementById('opacity-disp').textContent = e.target.value + '%';
        }

        function resetApp() { // Removed 'mode' parameter, assumes 'conv'
            FILE = null;
            FILE_URL = null;
            clearInterval(TIMER);
            document.getElementById(`file-input-conv`).value = '';
            showState('conv', 'upload');
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('final-actions').style.display = 'none';
            // Removed: document.getElementById('compare-wrapper').style.display = 'none';
            document.getElementById('preview-area').style.display = 'none';
            document.getElementById('progress-bar').style.backgroundColor = 'var(--primary)';
        }

        async function startJob(mode) {
            if (mode !== 'convert') { return; } // Safety check

            triggerResultView();
            startTime = Date.now();
            const fd = new FormData();
            fd.append('file', FILE);
            fd.append('mode', 'convert'); // Hardcoded since only 'convert' remains
            
            // Conversion Logic (kept all features)
            const conversion_key = document.getElementById('format-select').value;
            const settings = { 
                // Existing settings
                width: document.getElementById('inp-width').value, 
                height: document.getElementById('inp-height').value, 
                maintain_ar: document.getElementById('check-ar').checked,
                quality: document.getElementById('inp-quality').value,
                opacity: document.getElementById('inp-opacity').value,
                
                // New settings (Features 1-6, 21, 22)
                resample_filter: document.getElementById('resample-filter').value,
                rotation: document.getElementById('inp-rotation').value,
                flip: document.getElementById('inp-flip').value,
                grayscale: document.getElementById('check-grayscale').checked,
                brightness: document.getElementById('inp-brightness').value,
                contrast: document.getElementById('inp-contrast').value,
                sharpness: document.getElementById('inp-sharpness').value,
                
                // Format-specific settings
                progressive_jpeg: document.getElementById('check-progressive-jpeg') ? document.getElementById('check-progressive-jpeg').checked : false,
                optimize_png: document.getElementById('check-optimize-png') ? document.getElementById('check-optimize-png').checked : false,
                webp_lossless: document.getElementById('check-webp-lossless') ? document.getElementById('check-webp-lossless').checked : false,
                lossless_modern: document.getElementById('check-lossless-modern') ? document.getElementById('check-lossless-modern').checked : false,
            };
            fd.append('conversion_key', conversion_key);
            fd.append('settings', JSON.stringify(settings));
            
            try {
                // 1. Upload
                document.getElementById('status-head').textContent = "Uploading Image...";
                document.getElementById('status-text').textContent = "Sending file to secure environment.";
                
                const upload = await fetch('/api/upload', {
                    method: 'POST',
                    body: fd
                });
                
                if (!upload.ok) {
                    const error = await upload.json();
                    throw new Error(error.msg || "Upload failed due to server error.");
                }

                const res = await upload.json();
                const job_uuid = res.job_uuid;
                
                // 2. Start Polling
                document.getElementById('status-head').textContent = "Processing Image...";
                TIMER = setInterval(() => checkStatus(job_uuid), 1000);

            } catch (e) {
                clearInterval(TIMER);
                const bar = document.getElementById('progress-bar');
                document.getElementById('status-head').textContent = "Operation Failed!";
                document.getElementById('status-text').textContent = `Error: ${e.message}`;
                bar.style.width = "100%";
                bar.style.backgroundColor = 'var(--error)';
                document.getElementById('final-actions').style.display = 'block';
                document.getElementById('final-actions').innerHTML = `<button class="btn btn-primary" onclick="window.location.reload()">Try Again</button>`;
            }
        }

        async function checkStatus(job_uuid) {
            try {
                const req = await fetch(`/api/status/${job_uuid}`);
                const res = await req.json();

                const bar = document.getElementById('progress-bar');
                const head = document.getElementById('status-head');
                const txt = document.getElementById('status-text');

                const visualProgress = Math.max(res.progress || 0, 5);

                if (res.status === 'running' || res.status === 'queued') {
                    // Only conversion mode logic remains
                    head.textContent = "Processing Image Conversion...";
                    txt.textContent = res.log || (res.status === 'queued' ? "Waiting in queue..." : "Processing pixels...");
                    bar.style.width = visualProgress + "%";

                } else if (res.status === 'completed') {
                    clearInterval(TIMER);
                    bar.style.width = "100%";
                    document.getElementById('status-head').textContent = "Success!";
                    
                    // Calculate total time
                    const totalTimeSeconds = ((Date.now() - startTime) / 1000).toFixed(1);
                    txt.textContent = `Image processing complete in ${totalTimeSeconds} seconds. Download below.`;
                    
                    const acts = document.getElementById('final-actions');
                    acts.style.display = 'block';

                    let download_filename = res.download_url ? (res.download_url.split('/').pop().split('?')[0]) : 'processed_image.file';
                    
                    acts.innerHTML = `
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <a href="${res.download_url}" download="${download_filename}" class="btn btn-primary">
                                ‚¨áÔ∏è Download Final Image
                            </a>
                            <button onclick="resetApp()" class="btn btn-secondary">
                                ‚Ü©Ô∏è Start New Job
                            </button>
                        </div>
                    `;

                    const previewArea = document.getElementById('preview-area');
                    
                    // Only show standard preview (Comparison logic removed)
                    previewArea.style.display = 'block';
                    previewArea.innerHTML = `<img src="${res.download_url}" class="preview-img">`;


                } else if (res.status === 'failed') {
                    clearInterval(TIMER);
                    head.textContent = "Processing Failed!";
                    txt.textContent = `Error: ${res.log || "Unknown processing error."}`;
                    bar.style.width = "100%";
                    bar.style.backgroundColor = 'var(--error)';
                    document.getElementById('final-actions').style.display = 'block';
                    document.getElementById('final-actions').innerHTML = `<button class="btn btn-primary" onclick="window.location.reload()">Try Again</button>`;
                }
            } catch(e) {
                console.error(e);
                clearInterval(TIMER);
                document.getElementById('status-head').textContent = "Connection Error!";
                document.getElementById('status-text').textContent = `Could not communicate with the server. Please try again.`;
            }
        }

        // --- INITIALIZATION ---
        async function init() {
            try {
                const req = await fetch('/api/config');
                const res = await req.json();
                CONVERSIONS = res.conversions;
                populateSelect();
            } catch (e) {
                console.error("Backend Disconnected", e);
                document.getElementById('state-upload-conv').innerHTML = `
                    <div class="info-card" style="text-align: center; background: var(--error); color: white;">
                        <h3>Server Offline</h3>
                        <p>Could not connect to the backend processing service. Please check the server status.</p>
                    </div>
                `;
            }
            setupEvents();
            
            // Keep feature count text
            const aboutSection = document.querySelector('#view-about .info-card p:last-of-type');
            if (aboutSection) {
                aboutSection.innerHTML = `This version includes <strong>${featureCount}</strong> major new features, including advanced color correction, transformations, interpolation controls, and new modern output formats like AVIF and JXL.`;
            }
        }

        // Start
        init();
    </script>
</body>
</html>
