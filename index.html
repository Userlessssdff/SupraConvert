<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraConvert | Image Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            /* --- Palette: Modern Violet/Indigo --- */
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --primary-light: #e0e7ff;
            --secondary: #f8fafc;
            --surface: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;

            /* --- Status --- */
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;

            /* --- Smoothing & Physics --- */
            --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --duration: 0.4s;

            /* --- Depth --- */
            --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            --glass: rgba(255, 255, 255, 0.8);
        }

        /* --- Global Reset --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f1f5f9;
            background-image:
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(16, 185, 129, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        a { text-decoration: none; color: inherit; transition: color var(--duration) var(--ease-smooth); }
        ul { margin: 0; padding-left: 1.2rem; }
        li { margin-bottom: 0.5rem; }

        /* --- Layout Container --- */
        #app-frame {
            width: 100%;
            max-width: 1000px;
            margin: 2rem 1rem;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.6);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 80vh;
            position: relative;
        }

        /* --- Smooth Header --- */
        .app-header {
            padding: 1.5rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.5);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .brand span { color: var(--primary); }

        .nav-pills {
            display: flex;
            background: var(--secondary);
            padding: 0.3rem;
            border-radius: 99px;
            border: 1px solid var(--border);
        }

        .nav-item {
            padding: 0.6rem 1.5rem;
            border-radius: 99px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
        }
        .nav-item:hover { color: var(--text-main); }
        .nav-item.active {
            background: #fff;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        /* --- Animated Views --- */
        main { flex: 1; padding: 3rem; position: relative; }

        .view-section {
            /* Smooth Fade In/Out Logic */
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            position: absolute;
            top: 3rem;
            left: 3rem; right: 3rem;
            transition: opacity 0.4s ease, transform 0.4s var(--ease-out-back);
        }

        .view-section.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
            position: relative;
            top: 0; left: 0; right: 0;
        }

        /* --- Components: Typography --- */
        h1 { font-size: 2.5rem; font-weight: 800; letter-spacing: -0.04em; margin-bottom: 0.5rem; background: linear-gradient(135deg, #1e293b 0%, #6366f1 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { font-size: 1.8rem; font-weight: 700; margin-bottom: 1.5rem; color: var(--text-main); }
        h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-main); margin-top: 1.5rem;}
        h4 { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-main); margin-top: 1rem;}
        p { line-height: 1.7; color: var(--text-muted); margin-bottom: 1rem; }

        /* --- Component: Dropzone --- */
        .dropzone-container {
            border: 3px dashed var(--border);
            border-radius: 24px;
            background: linear-gradient(to bottom, #fcfcfc, #f1f5f9);
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-back);
            position: relative;
            overflow: hidden;
        }
        .dropzone-container:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        .dropzone-container.drag-over {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: scale(1.02);
        }
        .drop-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: inline-block;
            filter: drop-shadow(0 4px 6px rgba(99, 102, 241, 0.3));
            transition: transform 0.4s var(--ease-out-back);
        }
        .dropzone-container:hover .drop-icon { transform: scale(1.1) rotate(5deg); }

        /* --- Component: Info Cards (Policy/Contact) --- */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .info-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.3s var(--ease-smooth);
        }
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        .icon-badge {
            width: 48px; height: 48px;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        /* --- Component: Inputs & Selects --- */
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            background: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
            margin-bottom: 1rem;
        }
        .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 4px var(--primary-light); }

        /* --- Component: Collapsible Settings --- */
        .settings-accordion {
            border: 1px solid var(--border);
            border-radius: 16px;
            background: #fff;
            overflow: hidden;
            margin-bottom: 1rem;
            transition: box-shadow 0.3s;
        }
        .accordion-head {
            padding: 1rem 1.5rem;
            background: #fafafa;
            cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 600;
            transition: background 0.2s;
        }
        .accordion-head:hover { background: #f1f5f9; }
        .accordion-body {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.5s var(--ease-smooth);
            background: #fff;
        }
        .accordion-body.open {
            max-height: 1000px; /* Increased max-height for new content */
            opacity: 1;
            padding: 1.5rem;
            border-top: 1px solid var(--border);
        }
        .chevron { transition: transform 0.3s; }
        .settings-accordion.active .chevron { transform: rotate(180deg); }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.5rem; }
        .checkbox-group label { display: flex; align-items: center; gap: 0.5rem; }

        /* --- Component: Buttons --- */
        .btn {
            display: inline-flex; justify-content: center; align-items: center;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s var(--ease-out-back);
            gap: 0.5rem;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary {
            background: var(--primary); color: #fff;
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.39);
        }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.23); }
        .btn-primary:disabled { background: var(--text-muted); cursor: not-allowed; transform: none; }

        .btn-secondary { background: var(--secondary); color: var(--text-main); border: 1px solid var(--border); }
        .btn-secondary:hover { background: #e2e8f0; }

        /* --- Component: Progress Bar --- */
        .progress-track {
            height: 12px; background: var(--border);
            border-radius: 99px; overflow: hidden; margin: 2rem 0;
        }
        .progress-fill {
            height: 100%; width: 0%;
            background: var(--primary);
            border-radius: 99px;
            transition: width 0.5s ease-out;
            background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
            background-size: 1rem 1rem;
            animation: stripe-move 1s linear infinite;
        }
        @keyframes stripe-move { from { background-position: 1rem 0; } to { background-position: 0 0; } }

        /* --- Comparison Slider Styles (Kept, just in case, but no longer used for Upscale) --- */
        .comp-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 400px;
            margin: 2rem auto;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 4px solid #fff;
            background: #eee;
        }
        .comp-img {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: contain;
            object-position: left;
        }
        .comp-img-after {
            clip-path: inset(0 50% 0 0);
        }
        .comp-slider {
            position: absolute;
            -webkit-appearance: none;
            width: 100%; height: 100%;
            background: transparent;
            z-index: 10;
            top: 0; left: 0;
            margin: 0;
            outline: none;
            cursor: col-resize;
        }
        .comp-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 4px; height: 400px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            cursor: col-resize;
        }
        .comp-slider::-moz-range-thumb {
            width: 4px; height: 400px;
            background: #fff;
            border: none;
            cursor: col-resize;
        }
        .comp-label {
            position: absolute;
            bottom: 10px;
            padding: 4px 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            pointer-events: none;
            z-index: 5;
        }

        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.85rem;
            background: rgba(255,255,255,0.3);
        }

        /* Mobile Tweaks */
        @media (max-width: 600px) {
            .app-header { flex-direction: column; gap: 1rem; padding: 1rem; }
            main { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            .nav-pills { flex-wrap: wrap; justify-content: center; }
            .comp-container { height: 300px; }
        }
    </style>
</head>
<body>

    <div id="app-frame">
        <header class="app-header">
            <div class="brand" onclick="switchView('home')">
                <span>‚ö°</span> UltraConvert
            </div>
            <nav class="nav-pills">
                <div class="nav-item active" onclick="switchView('home')" id="nav-home">Converter</div>
                <div class="nav-item" onclick="switchView('policy')" id="nav-policy">Policy</div>
                <div class="nav-item" onclick="switchView('terms')" id="nav-terms">Terms</div>
                <div class="nav-item" onclick="switchView('about')" id="nav-about">About</div>
            </nav>
        </header>

        <main>
            <section id="view-home" class="view-section active">

                <div id="state-upload-conv">
                    <div style="text-align: center; margin-bottom: 3rem;">
                        <h1>Make Images Better.</h1>
                        <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto;">
                            The professional, privacy-first image tool. Convert formats, resize dimensions, and compress file sizes instantly on your local secure server.
                        </p>
                    </div>

                    <input type="file" id="file-input-conv" hidden accept="image/*">
                    <div id="dropzone-conv" class="dropzone-container">
                        <span class="drop-icon">üñºÔ∏è</span>
                        <h3>Drag & Drop your Image</h3>
                        <p>Supports JPG, PNG, WebP, GIF, TIFF, BMP, ICO</p>
                        <button class="btn btn-secondary" style="margin-top: 1rem;">Browse Files</button>
                    </div>
                </div>

                <div id="state-config-conv" class="hidden" style="display: none;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; background: #fff; padding: 1rem; border-radius: 12px; border: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span style="font-size: 1.5rem;">üìÅ</span>
                            <div>
                                <strong id="file-name-conv">File Name</strong>
                                <span style="color: var(--text-muted); font-size: 0.9rem;">(Original Size: <span id="file-size-conv">0 MB</span>)</span>
                            </div>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="resetApp('conv')">Cancel</button>
                    </div>

                    <h2>Conversion Settings</h2>

                    <div style="margin-bottom: 1.5rem;">
                        <h4>Target Format</h4>
                        <select id="format-select" class="form-control" onchange="updateFormatSettings()">
                            </select>
                    </div>

                    <div class="settings-accordion active" id="acc-features">
                        <div class="accordion-head" onclick="toggleAccordion('acc-features')">
                            <span>üé® Image Adjustments (11 New Controls)</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body open">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <h4>Filters</h4>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="check-grayscale"> Grayscale (Feature 4)</label>
                                        <label><input type="checkbox" id="check-sepia"> Sepia Tone (Feature 5)</label>
                                        <label><input type="checkbox" id="check-invert"> Invert Colors (Feature 6)</label>
                                    </div>
                                </div>
                                <div>
                                    <h4>Transforms</h4>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="check-flip-h"> Flip Horizontal (Feature 2)</label>
                                        <label><input type="checkbox" id="check-flip-v"> Flip Vertical (Feature 3)</label>
                                    </div>
                                    <h4 style="margin-top: 1rem;">Rotate (Feature 1)</h4>
                                    <input type="number" id="inp-rotate" class="form-control" placeholder="Angle in degrees (e.g., 90)" value="0" min="0" max="360" step="1">
                                </div>
                            </div>
                            
                            <hr style="border: 0; border-top: 1px solid var(--border); margin: 1.5rem 0;">
                            
                            <h4 style="margin-bottom: 1rem;">Enhancements</h4>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>üîÜ Brightness</span>
                                    <span style="font-weight: 700; color: var(--primary);" id="brightness-disp">100%</span>
                                </div>
                                <input type="range" id="inp-brightness" min="0" max="200" value="100" style="width: 100%; accent-color: var(--primary);">
                            </div>

                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>‚ö´‚ö™ Contrast</span>
                                    <span style="font-weight: 700; color: var(--primary);" id="contrast-disp">100%</span>
                                </div>
                                <input type="range" id="inp-contrast" min="0" max="200" value="100" style="width: 100%; accent-color: var(--primary);">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>üîç Sharpen Level</span>
                                    <span style="font-weight: 700; color: var(--primary);" id="sharpen-disp">0%</span>
                                </div>
                                <input type="range" id="inp-sharpen" min="0" max="100" value="0" style="width: 100%; accent-color: var(--primary);">
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>üå´Ô∏è Blur Level</span>
                                    <span style="font-weight: 700; color: var(--primary);" id="blur-disp">0</span>
                                </div>
                                <input type="range" id="inp-blur" min="0" max="100" value="0" style="width: 100%; accent-color: var(--primary);">
                            </div>

                            <hr style="border: 0; border-top: 1px solid var(--border); margin: 1.5rem 0;">

                            <h4 style="margin-bottom: 1rem;">Image Border (Bonus)</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <span>Border Size (px)</span>
                                    <input type="number" id="inp-border-size" class="form-control" value="0" min="0" max="500">
                                </div>
                                <div>
                                    <span>Border Color</span>
                                    <input type="color" id="inp-border-color" class="form-control" value="#000000">
                                </div>
                            </div>

                        </div>
                    </div>


                    <div class="settings-accordion" id="acc-quality">
                        <div class="accordion-head" onclick="toggleAccordion('acc-quality')">
                            <span>‚öôÔ∏è Quality & Compression</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <div id="quality-controls">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Image Quality</span>
                                    <span style="font-weight: 700; color: var(--primary);" id="quality-disp">90%</span>
                                </div>
                                <input type="range" id="inp-quality" min="1" max="100" value="90" style="width: 100%; accent-color: var(--primary);">
                                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                    <span>Low (Small Size)</span>
                                    <span>High (Best Look)</span>
                                </div>
                            </div>
                            <p id="quality-note" style="font-size: 0.9rem; margin-top: 1rem; color: var(--error); display: none;">
                                Note: This format does not support quality/compression control.
                            </p>
                        </div>
                    </div>

                    <div class="settings-accordion" id="acc-resize">
                        <div class="accordion-head" onclick="toggleAccordion('acc-resize')">
                            <span>üìè Resizing & Dimensions</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <span>Width (px)</span>
                                    <input type="number" id="inp-width" class="form-control" placeholder="Original">
                                </div>
                                <div>
                                    <span>Height (px)</span>
                                    <input type="number" id="inp-height" class="form-control" placeholder="Original">
                                </div>
                            </div>
                            <label style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                                <input type="checkbox" id="check-ar" checked>
                                Maintain Aspect Ratio (Resize to fit)
                            </label>
                        </div>
                    </div>


                    <div class="settings-accordion" id="acc-opacity">
                        <div class="accordion-head" onclick="toggleAccordion('acc-opacity')">
                            <span>üíß Transparency / Opacity</span>
                            <span class="chevron">‚ñº</span>
                        </div>
                        <div class="accordion-body">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Opacity Level</span>
                                <span style="font-weight: 700; color: var(--primary);" id="opacity-disp">100%</span>
                            </div>
                            <input type="range" id="inp-opacity" min="0" max="100" value="100" style="width: 100%; accent-color: var(--primary);">
                            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                <span>Transparent (Invisible)</span>
                                <span>Opaque (Solid)</span>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="startJob('convert')" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem; padding: 1.2rem;">
                        üöÄ Start Conversion
                    </button>
                </div>

                <div id="state-result" class="hidden" style="display: none; text-align: center; padding-top: 2rem;">
                    <h2 id="status-head">Processing Image...</h2>
                    <div class="progress-track">
                        <div id="progress-bar" class="progress-fill"></div>
                    </div>
                    <p id="status-text">Uploading to secure environment...</p>

                    <div id="final-actions" style="display: none;">
                        <div id="compare-wrapper" style="display:none;">
                            <h4 style="margin-top: 2rem;">Result Comparison (Drag the slider)</h4>
                            <div class="comp-container">
                                <img id="comp-before" class="comp-img" src="" alt="Before">
                                <div class="comp-label" style="left: 10px;">Original</div>
                                <img id="comp-after" class="comp-img comp-img-after" src="" alt="After">
                                <div class="comp-label" style="right: 10px;">New Image</div>
                                <input type="range" min="0" max="100" value="50" oninput="moveSlider(this.value)" class="comp-slider">
                            </div>
                            <p style="font-size: 0.9rem; color: var(--text-muted);">
                                Note: Comparison uses the original image for the "Before" state.
                            </p>
                        </div>

                        <div id="preview-area" style="margin: 2rem auto; max-width: 600px; display: none;">
                            <h4 style="margin-top: 2rem;">Processed Image Preview</h4>
                        </div>

                        <a id="download-btn" href="#" class="btn btn-primary" style="margin-top: 2rem; margin-bottom: 1rem;">
                            üì• Download File
                        </a>
                        <button class="btn btn-secondary" onclick="resetApp('conv')">Process Another</button>
                    </div>

                </div>

            </section>

            <section id="view-policy" class="view-section">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>Privacy Policy</h1>
                    <p>Last Updated: <script>document.write(new Date().toLocaleDateString())</script></p>
                </div>
                <div class="info-card" style="max-width: 900px; margin: 0 auto;">
                    <h3>1. Information We Collect</h3>
                    <p>We may collect the following types of data:</p>
                    <h4>A. Automatically Collected Data</h4>
                    <p>When you visit our site, we automatically collect:</p>
                    <ul>
                        <li>IP address</li>
                        <li>Browser type and version</li>
                        <li>Device information</li>
                        <li>Pages visited and time spent</li>
                        <li>Cookies and similar tracking technologies</li>
                    </ul>
                    <h4>B. Information You Provide Voluntarily</h4>
                    <ul>
                        <li>Form submissions (e.g., contact form)</li>
                        <li>Email address (if you subscribe or contact us)</li>
                        <li>Any content you upload or send through the site</li>
                    </ul>
                    <h3>2. Use of Cookies</h3>
                    <p>We use cookies for:</p>
                    <ul>
                        <li>Improving website performance</li>
                        <li>Understanding user behavior</li>
                        <li>Remembering user preferences</li>
                        <li>Serving personalized ads</li>
                    </ul>
                    <h4>Google AdSense Cookies</h4>
                    <p>We use Google AdSense, which may use:</p>
                    <ul>
                        <li>The DART cookie for ad serving based on your visit to this site and other sites on the internet.</li>
                        <li>Opt-out: You may opt out of the use of the DART cookie by visiting the Google Ad and Content Network Privacy Policy.</li>
                    </ul>
                    <h3>3. How We Use Your Data</h3>
                    <p>We use the collected data to:</p>
                    <ul>
                        <li>Operate, maintain, and improve our services.</li>
                        <li>Personalize your experience.</li>
                        <li>Process and execute your image conversion requests (files are deleted immediately after processing/download period).</li>
                        <li>Communicate with you (e.g., responding to inquiries).</li>
                        <li>Provide targeted advertisements.</li>
                    </ul>
                    <h3>4. Data Retention & Deletion</h3>
                    <p>Uploaded files and generated output files are automatically and permanently deleted from our servers approximately 30 minutes after the job is completed or after a download link expires.</p>
                    <h3>5. Data Security</h3>
                    <p>We implement industry-standard security measures, including SSL encryption and secure server environments, but no method of transmission over the Internet or electronic storage is 100% secure.</p>
                    <h3>6. Children's Privacy</h3>
                    <p>The service is not directed to children under the age of 13. We do not knowingly collect data from children.</p>
                    <h3>7. Links to External Websites</h3>
                    <p>Our website may contain links to third-party websites. We are not responsible for their privacy policies or content.</p>
                    <h3>8. Your Rights</h3>
                    <p>You may request:</p>
                    <ul>
                        <li>Access to your data</li>
                        <li>Deletion of your data</li>
                        <li>Correction of inaccurate data</li>
                        <li>Opt-out of personalized ads</li>
                    </ul>
                    <p>To do so, contact us at: <strong>[Your Contact Email]</strong></p>
                    <h3>9. Changes to This Privacy Policy</h3>
                    <p>We may update this policy from time to time. Any changes will be posted on this page with an updated date.</p>
                    <h3>10. Contact Us</h3>
                    <p>If you have any questions about this Privacy Policy, please contact us at:</p>
                    <p>üìß <strong>[Your Email]</strong></p>
                </div>
            </section>

            <section id="view-terms" class="view-section">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>Terms of Service</h1>
                </div>
                <div class="info-card" style="max-width: 900px; margin: 0 auto;">
                    <h3>1. Acceptance</h3>
                    <p>By using UltraConvert, you agree to these terms.</p>
                    <h3>2. License to UltraConvert</h3>
                    <p>You grant us a temporary license to process your files. We claim no ownership over your content.</p>
                    <h3>3. Restrictions</h3>
                    <p>You may not use this service to process illegal content or attempt to harm the service infrastructure.</p>
                    <h3>4. Disclaimer</h3>
                    <p>The service is provided "AS IS". We are not responsible for any data loss or corruption.</p>
                </div>
            </section>

            <section id="view-about" class="view-section">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>About UltraConvert</h1>
                </div>
                <div class="info-card" style="margin-bottom: 2rem;">
                    <h3>Purely Local Processing</h3>
                    <p>UltraConvert now runs entirely on your local server. All conversion and editing tasks are handled privately and quickly using the Python Pillow library.</p>
                    <ul>
                        <li><strong>Conversion & Editing:</strong> Runs locally on this server using Python Pillow. Fast and private.</li>
                        <li><strong>Features:</strong> Enjoy lossless format conversion, compression control, and the new suite of image editing tools (Rotate, Flip, Grayscale, Sepia, Brightness, Contrast, Sharpen, Blur, Border).</li>
                    </ul>
                </div>
                <div class="info-card">
                    <h3>Technical Stack</h3>
                    <p>The backend is built with Python/Flask, ensuring high performance and thread safety for concurrent jobs. The frontend is a modern, responsive HTML/CSS/JS application.</p>
                </div>
            </section>
        </main>

        <footer>
            &copy; <span id="current-year"></span> UltraConvert. All rights reserved.
        </footer>
    </div>

    <script>
        // --- GLOBALS ---
        let CONVERSIONS = [];
        let FILE = null;
        let FILE_URL = null;
        let TIMER = null;
        let currentJobId = null;

        // --- DOM MANIPULATION & HELPERS ---
        
        document.getElementById('current-year').textContent = new Date().getFullYear();

        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(`view-${viewId}`).classList.add('active');
            document.getElementById(`nav-${viewId}`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleAccordion(id) {
            const acc = document.getElementById(id);
            const body = acc.querySelector('.accordion-body');
            acc.classList.toggle('active');
            body.classList.toggle('open');
        }

        // Renamed and simplified: only handles 'conv' mode now
        function showState(stateSuffix) {
            document.getElementById('state-upload-conv').style.display = 'none';
            document.getElementById('state-config-conv').style.display = 'none';
            document.getElementById('state-result').style.display = 'none';
            
            const target = document.getElementById(`state-${stateSuffix}`);
            if (target) {
                target.style.display = 'block';
            }
        }

        function moveSlider(val) {
            const afterImg = document.getElementById('comp-after');
            const clipVal = 100 - val;
            afterImg.style.clipPath = `inset(0 ${clipVal}% 0 0)`;
        }

        function triggerResultView() {
            showState('result');
            const res = document.getElementById('state-result');
            // Reset transition for fade-in effect
            res.style.opacity = '0';
            res.style.transform = 'translateY(10px)';
            setTimeout(() => {
                res.style.transition = 'all 0.4s ease-out';
                res.style.opacity = '1';
                res.style.transform = 'translateY(0)';
            }, 10);
        }
        
        // --- INPUT HANDLERS ---
        
        function updateDisplay(idSuffix, val, unit = '') {
            const disp = document.getElementById(`${idSuffix}-disp`);
            if (disp) disp.textContent = `${val}${unit}`;
        }

        function setupSliderListeners() {
            // Quality
            document.getElementById('inp-quality').addEventListener('input', (e) => updateDisplay('quality', e.target.value, '%'));
            // Opacity
            document.getElementById('inp-opacity').addEventListener('input', (e) => updateDisplay('opacity', e.target.value, '%'));
            // Brightness (Feature 7)
            document.getElementById('inp-brightness').addEventListener('input', (e) => updateDisplay('brightness', e.target.value, '%'));
            // Contrast (Feature 8)
            document.getElementById('inp-contrast').addEventListener('input', (e) => updateDisplay('contrast', e.target.value, '%'));
            // Sharpen (Feature 9)
            document.getElementById('inp-sharpen').addEventListener('input', (e) => updateDisplay('sharpen', e.target.value));
            // Blur (Feature 10)
            document.getElementById('inp-blur').addEventListener('input', (e) => updateDisplay('blur', e.target.value));
        }
        
        function updateFormatSettings() {
            const select = document.getElementById('format-select');
            const selectedKey = select.value;
            const details = CONVERSIONS.find(c => c.key === selectedKey);
            
            const qualityControls = document.getElementById('quality-controls');
            const qualityNote = document.getElementById('quality-note');
            
            if (details && details.supports_quality) {
                qualityControls.style.display = 'block';
                qualityNote.style.display = 'none';
                document.getElementById('acc-quality').classList.remove('hidden');
            } else {
                qualityControls.style.display = 'none';
                qualityNote.style.display = 'block';
                document.getElementById('acc-quality').classList.remove('hidden'); // Keep visible but show note
            }
            
            // Auto-open quality accordion if it requires action
            if (details && !details.supports_quality) {
                document.getElementById('acc-quality').classList.add('active');
                document.getElementById('acc-quality').querySelector('.accordion-body').classList.add('open');
            } else {
                document.getElementById('acc-quality').classList.remove('active');
                document.getElementById('acc-quality').querySelector('.accordion-body').classList.remove('open');
            }
        }
        
        // --- CORE LOGIC ---
        
        async function init() {
            try {
                const req = await fetch('/api/config');
                const res = await req.json();
                CONVERSIONS = res.conversions;
                populateSelect();
            } catch (e) {
                console.error("Backend Disconnected", e);
                // Optionally show a disconnection error to the user
            }
            setupEvents();
            setupSliderListeners();
        }

        function populateSelect() {
            const sel = document.getElementById('format-select');
            sel.innerHTML = '';
            CONVERSIONS.forEach(c => {
                const option = document.createElement('option');
                option.value = c.key;
                option.textContent = c.name;
                sel.appendChild(option);
            });
            updateFormatSettings();
        }

        function setupEvents() {
            const dropzoneConv = document.getElementById('dropzone-conv');
            const fileInputConv = document.getElementById('file-input-conv');

            // Click listener
            dropzoneConv.onclick = () => fileInputConv.click();
            
            // Drag-drop listeners
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropzoneConv.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropzoneConv.addEventListener(eventName, () => dropzoneConv.classList.add('drag-over'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropzoneConv.addEventListener(eventName, () => dropzoneConv.classList.remove('drag-over'), false);
            });

            dropzoneConv.addEventListener('drop', handleDrop, false);
            fileInputConv.addEventListener('change', handleFileSelect, false);
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length) processFile(files[0], 'conv');
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length) processFile(files[0], 'conv');
        }

        function processFile(f, mode) {
            if (f.type && !f.type.startsWith('image/')) {
                alert("Only image files are supported.");
                return;
            }
            if (f.size > 500 * 1024 * 1024) { // Check against assumed 500MB limit
                 alert("File is too large. Max size is 500MB.");
                 return;
            }

            FILE = f;
            FILE_URL = URL.createObjectURL(f); // Create local preview URL
            const sizeStr = (f.size / (1024*1024)).toFixed(2) + " MB";
            
            // Only 'conv' mode remains
            document.getElementById('file-name-conv').textContent = f.name;
            document.getElementById('file-size-conv').textContent = sizeStr;
            showState('config-conv');
        }

        function resetApp() {
            // Clears all state for the single 'conv' mode
            FILE = null;
            if (FILE_URL) URL.revokeObjectURL(FILE_URL);
            FILE_URL = null;
            currentJobId = null;
            clearInterval(TIMER);
            document.getElementById(`file-input-conv`).value = '';
            showState('upload-conv');
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('final-actions').style.display = 'none';
            document.getElementById('compare-wrapper').style.display = 'none';
            document.getElementById('preview-area').style.display = 'none';

            // Reset all controls to default state to ensure security and proper next run
            document.getElementById('inp-width').value = '';
            document.getElementById('inp-height').value = '';
            document.getElementById('check-ar').checked = true;
            document.getElementById('inp-quality').value = 90;
            document.getElementById('inp-opacity').value = 100;
            document.getElementById('inp-rotate').value = 0;
            document.getElementById('check-flip-h').checked = false;
            document.getElementById('check-flip-v').checked = false;
            document.getElementById('check-grayscale').checked = false;
            document.getElementById('check-sepia').checked = false;
            document.getElementById('check-invert').checked = false;
            document.getElementById('inp-brightness').value = 100;
            document.getElementById('inp-contrast').value = 100;
            document.getElementById('inp-sharpen').value = 0;
            document.getElementById('inp-blur').value = 0;
            document.getElementById('inp-border-size').value = 0;
            document.getElementById('inp-border-color').value = '#000000';
            updateDisplay('quality', 90, '%');
            updateDisplay('opacity', 100, '%');
            updateDisplay('brightness', 100, '%');
            updateDisplay('contrast', 100, '%');
            updateDisplay('sharpen', 0);
            updateDisplay('blur', 0);
        }

        async function startJob(mode) {
            if (!FILE) {
                alert("Please select a file first.");
                return;
            }

            triggerResultView(); // Show shared result view
            const startTime = Date.now();

            const fd = new FormData();
            fd.append('file', FILE);
            fd.append('mode', 'convert'); // Only 'convert' remains
            fd.append('conversion_key', document.getElementById('format-select').value);

            // Collect all settings including the 10 new features
            const settings = {
                // Resize
                width: document.getElementById('inp-width').value || null,
                height: document.getElementById('inp-height').value || null,
                maintain_ar: document.getElementById('check-ar').checked,
                // Quality/Opacity
                quality: document.getElementById('inp-quality').value,
                opacity: document.getElementById('inp-opacity').value,
                // New Transform/Filters
                rotate_angle: document.getElementById('inp-rotate').value,
                flip_h: document.getElementById('check-flip-h').checked,
                flip_v: document.getElementById('check-flip-v').checked,
                filter_grayscale: document.getElementById('check-grayscale').checked,
                filter_sepia: document.getElementById('check-sepia').checked,
                filter_invert: document.getElementById('check-invert').checked,
                // New Enhancements
                brightness: document.getElementById('inp-brightness').value,
                contrast: document.getElementById('inp-contrast').value,
                sharpen: document.getElementById('inp-sharpen').value,
                blur: document.getElementById('inp-blur').value,
                // New Border
                border_size: document.getElementById('inp-border-size').value,
                border_color: document.getElementById('inp-border-color').value,
            };

            fd.append('settings', JSON.stringify(settings));

            document.getElementById('status-head').textContent = "Uploading File...";
            document.getElementById('status-text').textContent = "Please wait, uploading to secure server...";
            document.getElementById('progress-bar').style.backgroundColor = 'var(--primary)';

            try {
                const req = await fetch('/api/jobs', {
                    method: 'POST',
                    body: fd
                });
                
                const res = await req.json();

                if (req.status === 202) {
                    currentJobId = res.job_id;
                    TIMER = setInterval(() => getJobStatus(currentJobId, startTime), 1000);
                } else {
                    clearInterval(TIMER);
                    document.getElementById('status-head').textContent = "Upload Failed!";
                    document.getElementById('status-text').textContent = `Error: ${res.msg || "Unknown error."}`;
                    document.getElementById('progress-bar').style.backgroundColor = 'var(--error)';
                }
            } catch (e) {
                console.error("Upload failed:", e);
                clearInterval(TIMER);
                document.getElementById('status-head').textContent = "Connection Error!";
                document.getElementById('status-text').textContent = `Could not connect to the server.`;
                document.getElementById('progress-bar').style.backgroundColor = 'var(--error)';
            }
        }

        async function getJobStatus(job_uuid, startTime) {
            const bar = document.getElementById('progress-bar');
            const head = document.getElementById('status-head');
            const txt = document.getElementById('status-text');
            const now = Date.now();
            
            try {
                const req = await fetch(`/api/status/${job_uuid}`);
                const res = await req.json();

                if (res.status === 'queued' || res.status === 'running') {
                    const elapsed = ((now - startTime) / 1000).toFixed(0);
                    let visualProgress = Math.max(res.progress, 1); // Ensure bar starts visible

                    // Adjust status text and progress visually
                    head.textContent = "Processing Image Conversion...";
                    txt.textContent = res.status === 'queued' ? 
                        "Waiting in queue..." : 
                        `Processing pixels... (${visualProgress}% done, ${elapsed}s elapsed)`;
                    
                    bar.style.width = visualProgress + "%";
                } else if (res.status === 'completed') {
                    clearInterval(TIMER);
                    bar.style.width = "100%";
                    document.getElementById('status-head').textContent = "Success!";
                    txt.textContent = "Image processing complete. Download below.";

                    const acts = document.getElementById('final-actions');
                    acts.style.display = 'block';
                    acts.style.opacity = 0;
                    setTimeout(() => acts.style.opacity = 1, 10);

                    document.getElementById('download-btn').href = res.download_url;

                    // Setup Preview/Comparison
                    const compBtn = document.getElementById('check-compare'); // Assuming a checkbox for compare exists
                    
                    const settings = JSON.parse(res.settings);
                    
                    // Show comparison if any of the new features or transformations were applied
                    const isTransformed = settings.rotate_angle != 0 || 
                                          settings.flip_h || settings.flip_v ||
                                          settings.filter_grayscale || settings.filter_sepia || settings.filter_invert ||
                                          settings.brightness != 100 || settings.contrast != 100 || settings.sharpen != 0 || settings.blur != 0 ||
                                          settings.border_size != 0 || settings.width || settings.height;

                    if (isTransformed) {
                        // Comparison Preview
                        document.getElementById('preview-area').style.display = 'none';
                        document.getElementById('compare-wrapper').style.display = 'block';
                        document.getElementById('comp-before').src = FILE_URL; // Original file URL
                        document.getElementById('comp-after').src = res.download_url;
                        moveSlider(50);
                    } else {
                        // Standard Preview (for format change only)
                        document.getElementById('compare-wrapper').style.display = 'none';
                        const pbox = document.getElementById('preview-area');
                        pbox.style.display = 'block';
                        pbox.innerHTML = `<img src="${res.download_url}" class="preview-img" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: var(--shadow-md);">`;
                    }

                } else if (res.status === 'failed') {
                    clearInterval(TIMER);
                    head.textContent = "Processing Failed!";
                    txt.textContent = `Error: ${res.log || "Unknown processing error."}`;
                    bar.style.width = "100%";
                    bar.style.backgroundColor = 'var(--error)';
                    // Provide a restart button immediately
                    document.getElementById('final-actions').style.display = 'block';
                    document.getElementById('final-actions').innerHTML = `<button class="btn btn-primary" onclick="resetApp()">Try Again</button>`;
                }
            } catch(e) {
                console.error(e);
                clearInterval(TIMER);
                head.textContent = "Connection Error!";
                txt.textContent = `Could not communicate with the server. Please try again.`;
                bar.style.backgroundColor = 'var(--error)';
            }
        }

        // Start
        init();
    </script>
</body>
</html>
