<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraConvert | Image Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            /* --- Palette: Modern Violet/Indigo --- */
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --primary-light: #e0e7ff;
            --secondary: #f8fafc;
            --surface: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;

            /* --- Status --- */
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;

            /* --- Smoothing & Physics --- */
            --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --duration: 0.4s;

            /* --- Depth --- */
            --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            --glass: rgba(255, 255, 255, 0.8);
        }

        /* --- Global Reset --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f1f5f9;
            background-image:
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(16, 185, 129, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        a { text-decoration: none; color: inherit; transition: color var(--duration) var(--ease-smooth); }
        ul { margin: 0; padding-left: 1.2rem; }
        li { margin-bottom: 0.5rem; }

        /* --- Layout Container --- */
        #app-frame {
            width: 100%;
            max-width: 1000px;
            margin: 2rem 1rem;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.6);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 80vh;
            position: relative;
        }

        /* --- Smooth Header --- */
        .app-header {
            padding: 1.5rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.5);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .brand span { color: var(--primary); }

        .nav-pills {
            display: flex;
            background: var(--secondary);
            padding: 0.3rem;
            border-radius: 99px;
            border: 1px solid var(--border);
        }

        .nav-item {
            padding: 0.6rem 1.5rem;
            border-radius: 99px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
        }
        .nav-item:hover { color: var(--text-main); }
        .nav-item.active {
            background: #fff;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        /* --- Animated Views --- */
        main { flex: 1; padding: 3rem; position: relative; }

        .view-section {
            /* Smooth Fade In/Out Logic */
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            position: absolute;
            top: 3rem;
            left: 3rem; right: 3rem;
            transition: opacity 0.4s ease, transform 0.4s var(--ease-out-back);
        }

        .view-section.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
            position: relative;
            top: 0; left: 0; right: 0;
        }

        /* --- Components: Typography --- */
        h1 { font-size: 2.5rem; font-weight: 800; letter-spacing: -0.04em; margin-bottom: 0.5rem; background: linear-gradient(135deg, #1e293b 0%, #6366f1 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { font-size: 1.8rem; font-weight: 700; margin-bottom: 1.5rem; color: var(--text-main); }
        h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-main); margin-top: 1.5rem;}
        h4 { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-main); margin-top: 1rem;}
        p { line-height: 1.7; color: var(--text-muted); margin-bottom: 1rem; }

        /* --- Component: Dropzone --- */
        .dropzone-container {
            border: 3px dashed var(--border);
            border-radius: 24px;
            background: linear-gradient(to bottom, #fcfcfc, #f1f5f9);
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-back);
            position: relative;
            overflow: hidden;
        }
        .dropzone-container:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        .dropzone-container.drag-over {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: scale(1.02);
        }
        .drop-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: inline-block;
            filter: drop-shadow(0 4px 6px rgba(99, 102, 241, 0.3));
            transition: transform 0.4s var(--ease-out-back);
        }
        .dropzone-container:hover .drop-icon { transform: scale(1.1) rotate(5deg); }

        /* --- Component: Info Cards (Policy/Contact) --- */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .info-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.3s var(--ease-smooth);
        }
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        .icon-badge {
            width: 48px; height: 48px;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        /* --- Component: Inputs & Selects --- */
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            background: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
            margin-bottom: 1rem;
        }
        .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 4px var(--primary-light); }

        /* --- Component: Collapsible Settings --- */
        .settings-accordion {
            border: 1px solid var(--border);
            border-radius: 16px;
            background: #fff;
            overflow: hidden;
            margin-bottom: 1rem;
            transition: box-shadow 0.3s;
        }
        .accordion-head {
            padding: 1rem 1.5rem;
            background: #fafafa;
            cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 600;
            transition: background 0.2s;
        }
        .accordion-head:hover { background: #f1f5f9; }
        .accordion-body {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.5s var(--ease-smooth);
            background: #fff;
        }
        .accordion-body.open {
            max-height: 500px;
            opacity: 1;
            padding: 1.5rem;
            border-top: 1px solid var(--border);
        }
        .chevron { transition: transform 0.3s; }
        .settings-accordion.active .chevron { transform: rotate(180deg); }

        /* --- Component: Buttons --- */
        .btn {
            display: inline-flex; justify-content: center; align-items: center;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s var(--ease-out-back);
            gap: 0.5rem;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary {
            background: var(--primary); color: #fff;
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.39);
        }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.23); }
        .btn-primary:disabled { background: var(--text-muted); cursor: not-allowed; transform: none; }

        .btn-secondary { background: var(--secondary); color: var(--text-main); border: 1px solid var(--border); }
        .btn-secondary:hover { background: #e2e8f0; }

        /* --- Component: Progress Bar --- */
        .progress-track {
            height: 12px; background: var(--border);
            border-radius: 99px; overflow: hidden; margin: 2rem 0;
        }
        .progress-fill {
            height: 100%; width: 0%;
            background: var(--primary);
            border-radius: 99px;
            transition: width 0.5s ease-out;
            background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
            background-size: 1rem 1rem;
            animation: stripe-move 1s linear infinite;
        }
        @keyframes stripe-move { from { background-position: 1rem 0; } to { background-position: 0 0; } }

        /* --- Comparison Slider Styles --- */
        .comp-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 400px;
            margin: 2rem auto;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 4px solid #fff;
            background: #eee;
        }
        .comp-img {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: contain;
            object-position: left;
        }
        .comp-img-after {
            clip-path: inset(0 50% 0 0);
        }
        .comp-slider {
            position: absolute;
            -webkit-appearance: none;
            width: 100%; height: 100%;
            background: transparent;
            z-index: 10;
            top: 0; left: 0;
            margin: 0;
            outline: none;
            cursor: col-resize;
        }
        .comp-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 4px; height: 400px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            cursor: col-resize;
        }
        .comp-slider::-moz-range-thumb {
            width: 4px; height: 400px;
            background: #fff;
            border: none;
            cursor: col-resize;
        }
        .comp-label {
            position: absolute;
            bottom: 10px;
            padding: 4px 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            pointer-events: none;
            z-index: 5;
        }

        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.85rem;
            background: rgba(255,255,255,0.3);
        }

        /* Mobile Tweaks */
        @media (max-width: 600px) {
            .app-header { flex-direction: column; gap: 1rem; padding: 1rem; }
            main { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            .nav-pills { flex-wrap: wrap; justify-content: center; }
            .comp-container { height: 300px; }
        }
    </style>
</head>
<body>

    <div id="app-frame">
        <header class="app-header">
            <div class="brand" onclick="switchView('home')">
                <span>‚ö°</span> UltraConvert
            </div>
            <nav class="nav-pills">
                <div class="nav-item active" onclick="switchView('home')" id="nav-home">Converter</div>
                <div class="nav-item" onclick="switchView('upscale')" id="nav-upscale">Upscale ‚ú®</div>
                <div class="nav-item" onclick="switchView('policy')" id="nav-policy">Policy</div>
                <div class="nav-item" onclick="switchView('terms')" id="nav-terms">Terms</div>
                <div class="nav-item" onclick="switchView('about')" id="nav-about">About</div>
            </nav>
        </header>

        <main>
            <section id="view-home" class="view-section active">

                <div id="state-upload-conv">
                    <div style="text-align: center; margin-bottom: 3rem;">
                        <h1>Make Images Better.</h1>
                        <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto;">
                            The professional, privacy-first image tool. Convert formats, resize dimensions, and compress file sizes instantly on your local secure server.
                        </p>
                    </div>

                    <input type="file" id="file-input-conv" hidden accept="image/*">
                    <div id="dropzone-conv" class="dropzone-container">
                        <span class="drop-icon">üñºÔ∏è</span>
                        <h3>Drag & Drop your Image</h3>
                        <p>Supports JPG, PNG, WebP, GIF, TIFF, BMP, ICO</p>
                        <button class="btn btn-secondary" style="margin-top: 1rem;">Browse Files</button>
                    </div>
                </div>

                <div id="state-config-conv" class="hidden" style="display: none;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; background: #fff; padding: 1rem; border-radius: 12px; border: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="font-size: 2rem;">üìÑ</div>
                            <div>
                                <div style="font-weight: 700;" id="file-name-conv">image.png</div>
                                <div style="font-size: 0.9rem; color: var(--text-muted);" id="file-size-conv">2.4 MB</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="resetApp('conv')">Change File</button>
                    </div>

                    <div style="max-width: 600px; margin: 0 auto;">
                        <label style="font-weight: 700; display: block; margin-bottom: 0.5rem;">Target Format</label>
                        <select id="format-select" class="form-control">
                            </select>

                        <div class="settings-accordion" id="acc-resize">
                            <div class="accordion-head" onclick="toggleAccordion('acc-resize')">
                                <span>üìê Resize & Scale</span>
                                <span class="chevron">‚ñº</span>
                            </div>
                            <div class="accordion-body">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div>
                                        <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; display: block;">Width (px)</label>
                                        <input type="number" id="inp-width" class="form-control" placeholder="Original">
                                    </div>
                                    <div>
                                        <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; display: block;">Height (px)</label>
                                        <input type="number" id="inp-height" class="form-control" placeholder="Original">
                                    </div>
                                </div>
                                <label style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="check-ar" checked style="width: 1.2rem; height: 1.2rem; accent-color: var(--primary);">
                                    <span style="font-size: 0.9rem;">Maintain Aspect Ratio</span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-accordion" id="acc-quality">
                            <div class="accordion-head" onclick="toggleAccordion('acc-quality')">
                                <span>üé® Quality & Compression</span>
                                <span class="chevron">‚ñº</span>
                            </div>
                            <div class="accordion-body">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Compression Level</span>
                                    <span style="font-weight: 700; color: var(--primary);" id="quality-disp">90%</span>
                                </div>
                                <input type="range" id="inp-quality" min="1" max="100" value="90" style="width: 100%; accent-color: var(--primary);">
                                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                    <span>Low (Small Size)</span>
                                    <span>High (Best Look)</span>
                                </div>
                            </div>
                        </div>

                         <div class="settings-accordion" id="acc-opacity">
                            <div class="accordion-head" onclick="toggleAccordion('acc-opacity')">
                                <span>üíß Transparency / Opacity</span>
                                <span class="chevron">‚ñº</span>
                            </div>
                            <div class="accordion-body">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Opacity Level</span>
                                    <span style="font-weight: 700; color: var(--primary);" id="opacity-disp">100%</span>
                                </div>
                                <input type="range" id="inp-opacity" min="0" max="100" value="100" style="width: 100%; accent-color: var(--primary);">
                                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                    <span>Transparent (Invisible)</span>
                                    <span>Opaque (Solid)</span>
                                </div>
                            </div>
                        </div>

                        <button onclick="startJob('convert')" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem; padding: 1.2rem;">
                            üöÄ Start Conversion
                        </button>
                    </div>
                </div>

                <div id="state-result" class="hidden" style="display: none; text-align: center; padding-top: 2rem;">
                    <h2 id="status-head">Processing Image...</h2>

                    <div class="progress-track">
                        <div id="progress-bar" class="progress-fill"></div>
                    </div>
                    <p id="status-text">Uploading to secure environment...</p>

                    <div id="final-actions" style="display: none;">
                        <div id="compare-wrapper" style="display:none;">
                            <div class="comp-container">
                                <img id="comp-before" class="comp-img" src="" alt="Before">
                                <div class="comp-label" style="left: 10px;">Before</div>
                                
                                <img id="comp-after" class="comp-img comp-img-after" src="" alt="After">
                                <div class="comp-label" style="right: 10px;">After</div>
                                
                                <input type="range" min="0" max="100" value="50" class="comp-slider" id="comp-slider-input" oninput="moveSlider(this.value)">
                            </div>
                            <p style="font-size: 0.9rem; color: var(--text-muted);">Slide to compare</p>
                        </div>

                        <div class="preview-box" id="preview-area" style="display:none;"></div>

                        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
                            <a id="btn-download" class="btn btn-primary" href="#" target="_blank">‚¨áÔ∏è Download Image</a>
                            <button class="btn btn-secondary" onclick="window.location.reload()">üîÑ Start Over</button>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--success); margin-top: 1rem;">
                            ‚úÖ File is ready.
                        </p>
                    </div>
                </div>

            </section>

            <section id="view-upscale" class="view-section">
                <div id="state-upload-up">
                    <div style="text-align: center; margin-bottom: 3rem;">
                        <h1>AI Image Upscaling</h1>
                        <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto;">
                            Enhance resolution and details using state-of-the-art AI models via Hugging Face.
                        </p>
                    </div>

                    <input type="file" id="file-input-up" hidden accept="image/*">
                    <div id="dropzone-up" class="dropzone-container" style="border-color: #8b5cf6; background: linear-gradient(to bottom, #f5f3ff, #f1f5f9);">
                        <span class="drop-icon">‚ú®</span>
                        <h3>Drag & Drop to Upscale</h3>
                        <p>Automatically enhances quality and resolution.</p>
                        <button class="btn btn-secondary" style="margin-top: 1rem;">Browse Files</button>
                    </div>
                </div>

                <div id="state-config-up" class="hidden" style="display: none;">
                     <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; background: #fff; padding: 1rem; border-radius: 12px; border: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="font-size: 2rem;">‚ú®</div>
                            <div>
                                <div style="font-weight: 700;" id="file-name-up">image.png</div>
                                <div style="font-size: 0.9rem; color: var(--text-muted);" id="file-size-up">2.4 MB</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="resetApp('up')">Change File</button>
                    </div>

                    <div style="max-width: 500px; margin: 0 auto; text-align: center;">
                         <label style="font-weight: 700; display: block; margin-bottom: 0.5rem; text-align: left;">Target Resolution</label>
                         <select id="upscale-res" class="form-control">
                             <option value="original">2x Enlarge (AI Native)</option>
                             <option value="1080p">1080p (Full HD)</option>
                             <option value="2k">2K (QHD)</option>
                             <option value="4k">4K (UHD)</option>
                         </select>

                         <p style="font-size:0.9rem; color: var(--text-muted; margin-top: 1rem;">
                             Using <strong>Swin2SR</strong> model. Large files may take ~20 seconds.
                         </p>
                         <button onclick="startJob('upscale')" class="btn btn-primary" style="background: #8b5cf6; width: 100%; margin-top: 1rem; padding: 1.2rem;">
                            ‚ú® Start Magic Upscale
                        </button>
                    </div>
                </div>
            </section>

            <section id="view-policy" class="view-section">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>Privacy Policy</h1>
                    <p>Last Updated: <script>document.write(new Date().toLocaleDateString())</script></p>
                </div>

                <div class="info-card" style="max-width: 900px; margin: 0 auto;">
                    <h3>1. Information We Collect</h3>
                    <p>We may collect the following types of data:</p>
                    
                    <h4>A. Automatically Collected Data</h4>
                    <p>When you visit our site, we automatically collect:</p>
                    <ul>
                        <li>IP address</li>
                        <li>Browser type and version</li>
                        <li>Device information</li>
                        <li>Pages visited and time spent</li>
                        <li>Cookies and similar tracking technologies</li>
                    </ul>

                    <h4>B. Information You Provide Voluntarily</h4>
                    <ul>
                        <li>Form submissions (e.g., contact form)</li>
                        <li>Email address (if you subscribe or contact us)</li>
                        <li>Any content you upload or send through the site</li>
                    </ul>

                    <h3>2. Use of Cookies</h3>
                    <p>We use cookies for:</p>
                    <ul>
                        <li>Improving website performance</li>
                        <li>Understanding user behavior</li>
                        <li>Remembering user preferences</li>
                        <li>Serving personalized ads</li>
                    </ul>

                    <h4>Google AdSense Cookies</h4>
                    <p>We use Google AdSense, which may use:</p>
                    <ul>
                        <li>Cookies</li>
                        <li>Web beacons</li>
                        <li>DART cookies (for personalized advertising)</li>
                    </ul>
                    <p>Google may use your data to deliver ads based on your previous visits to our website or others and to personalize ad experiences.</p>
                    <p>Users can opt out of personalized advertising by visiting: <a href="https://www.google.com/settings/ads" target="_blank" style="color:var(--primary); font-weight:700;">Google Ad Settings</a></p>

                    <h3>3. How We Use Your Information</h3>
                    <p>We use collected data for:</p>
                    <ul>
                        <li>Improving website functionality and performance</li>
                        <li>Personalizing user experience</li>
                        <li>Analytics and security</li>
                        <li>Showing relevant ads (via Google AdSense)</li>
                        <li>Responding to your inquiries</li>
                    </ul>

                    <h3>4. Third-Party Advertising and Services</h3>
                    <p>We may share anonymized data with:</p>
                    <ul>
                        <li>Google AdSense</li>
                        <li>Google Analytics</li>
                        <li>Advertising networks</li>
                        <li>Security or analytics partners</li>
                    </ul>
                    <p>These parties follow their own privacy policies. You can review Google‚Äôs policies here: <a href="https://policies.google.com/technologies/ads" target="_blank" style="color:var(--primary); font-weight:700;">Google Ads Privacy</a></p>

                    <h3>5. Data Protection & Security</h3>
                    <p>We take reasonable steps to protect your information by:</p>
                    <ul>
                        <li>Using encrypted connections (HTTPS)</li>
                        <li>Limiting access to data</li>
                        <li>Preventing unauthorized access</li>
                    </ul>
                    <p>However, no method is 100% secure, and we cannot guarantee absolute protection.</p>

                    <h3>6. Children's Privacy</h3>
                    <p>Our website is not intended for children under 13. We do not knowingly collect data from children.</p>

                    <h3>7. Links to External Websites</h3>
                    <p>Our website may contain links to third-party websites. We are not responsible for their privacy policies or content.</p>

                    <h3>8. Your Rights</h3>
                    <p>You may request:</p>
                    <ul>
                        <li>Access to your data</li>
                        <li>Deletion of your data</li>
                        <li>Correction of inaccurate data</li>
                        <li>Opt-out of personalized ads</li>
                    </ul>
                    <p>To do so, contact us at: <strong>[Your Contact Email]</strong></p>

                    <h3>9. Changes to This Privacy Policy</h3>
                    <p>We may update this policy from time to time. Any changes will be posted on this page with an updated date.</p>

                    <h3>10. Contact Us</h3>
                    <p>If you have any questions about this Privacy Policy, please contact us at:</p>
                    <p>üìß <strong>[Your Email]</strong></p>
                </div>
            </section>

            <section id="view-terms" class="view-section">
                 <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>Terms of Service</h1>
                </div>
                <div class="info-card" style="max-width: 900px; margin: 0 auto;">
                    <h3>1. Acceptance</h3>
                    <p>By using UltraConvert, you agree to these terms.</p>
                    
                    <h3>2. License to UltraConvert</h3>
                    <p>You grant us a temporary license to process your files. We claim no ownership over your content.</p>
                    
                    <h3>3. Restrictions</h3>
                    <p>You may not use this service to process illegal content or attempt to harm the service infrastructure.</p>
                    
                    <h3>4. Disclaimer</h3>
                    <p>The service is provided "AS IS". We are not responsible for any data loss or corruption.</p>
                </div>
            </section>

             <section id="view-about" class="view-section">
                <div style="text-align: center; margin-bottom: 3rem;">
                    <h1>About UltraConvert</h1>
                </div>
                <div class="info-card" style="margin-bottom: 2rem;">
                    <h3>Hybrid Architecture</h3>
                    <p>UltraConvert combines local Python Pillow processing with powerful cloud AI.</p>
                    <ul>
                        <li><strong>Conversion:</strong> Runs locally on this server using Python Pillow. Fast and private.</li>
                        <li><strong>Upscaling:</strong> Powered by the Hugging Face Inference API, utilizing advanced Super Resolution models (Swin2SR).</li>
                    </ul>
                </div>
            </section>

        </main>

        <footer>
            &copy; <script>document.write(new Date().getFullYear())</script> UltraConvert. Secure. Fast. AI-Powered.
        </footer>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let CONVERSIONS = [];
        let FILE = null; // Current file object
        let FILE_URL = null; // URL for previewing the input file
        let JOB_ID = null;
        let TIMER = null;
        let startTime = 0; // NEW: Track start time for visual progress

        // --- NAVIGATION ---
        function switchView(viewId) {
            // Update Header Tabs
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const nav = document.getElementById(`nav-${viewId}`);
            if(nav) nav.classList.add('active');

            // Animate Views
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            const target = document.getElementById(`view-${viewId}`);
            if(target) target.classList.add('active');
            
            // Hide global result if switching tabs
            document.getElementById('state-result').style.display = 'none';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- UI INTERACTION ---
        function toggleAccordion(id) {
            const acc = document.getElementById(id);
            const body = acc.querySelector('.accordion-body');
            acc.classList.toggle('active');
            body.classList.toggle('open');
        }

        function showState(mode, stateSuffix) {
             // Hide all states in current view
             if(mode === 'conv') {
                 document.getElementById('state-upload-conv').style.display = 'none';
                 document.getElementById('state-config-conv').style.display = 'none';
                 document.getElementById(`state-${stateSuffix}-conv`).style.display = 'block';
             } else if (mode === 'up') {
                 document.getElementById('state-upload-up').style.display = 'none';
                 document.getElementById('state-config-up').style.display = 'none';
                 document.getElementById(`state-${stateSuffix}-up`).style.display = 'block';
             }
        }
        
        function moveSlider(val) {
            const afterImg = document.getElementById('comp-after');
            // Clip the top image from the right side based on slider value
            // 100% slider = 0% clip (fully visible)
            // 0% slider = 100% clip (hidden)
            const clipVal = 100 - val;
            afterImg.style.clipPath = `inset(0 ${clipVal}% 0 0)`;
        }

        function triggerResultView() {
            // Hide configs
            document.getElementById('state-config-conv').style.display = 'none';
            document.getElementById('state-config-up').style.display = 'none';
            
            const res = document.getElementById('state-result');
            res.style.display = 'block';
            res.style.opacity = '0';
            res.style.transform = 'translateY(10px)';
            setTimeout(() => {
                res.style.transition = 'all 0.4s ease-out';
                res.style.opacity = '1';
                res.style.transform = 'translateY(0)';
            }, 10);
        }

        // --- INITIALIZATION ---
        async function init() {
            try {
                const req = await fetch('/api/config');
                const res = await req.json();
                CONVERSIONS = res.conversions;
                populateSelect();
            } catch (e) {
                console.error("Backend Disconnected", e);
            }
            setupEvents();
        }

        function populateSelect() {
            const sel = document.getElementById('format-select');
            // Filter out 'ai_upscale' from standard conversions
            const conversionOptions = CONVERSIONS.filter(c => c.key !== 'ai_upscale');

            sel.innerHTML = conversionOptions.map(c =>
                `<option value="${c.key}" data-quality="${c.supports_quality}">${c.name}</option>`
            ).join('');

            // Quality Toggle Listener
            sel.addEventListener('change', () => {
                const opt = sel.options[sel.selectedIndex];
                const accQ = document.getElementById('acc-quality');
                if(opt.dataset.quality === 'true') {
                    accQ.style.display = 'block';
                } else {
                    accQ.style.display = 'none';
                }
            });
            sel.dispatchEvent(new Event('change')); 
        }

        function setupEvents() {
            // Converter Logic
            setupDropzone('dropzone-conv', 'file-input-conv', 'conv');
            
            // Upscaler Logic
            setupDropzone('dropzone-up', 'file-input-up', 'up');

            // Sliders
            document.getElementById('inp-quality').oninput = (e) => {
                document.getElementById('quality-disp').textContent = e.target.value + '%';
            };
            document.getElementById('inp-opacity').oninput = (e) => {
                document.getElementById('opacity-disp').textContent = e.target.value + '%';
            };
        }

        function setupDropzone(dzId, inpId, mode) {
            const dz = document.getElementById(dzId);
            const inp = document.getElementById(inpId);

            dz.onclick = () => inp.click();
            dz.ondragover = (e) => { e.preventDefault(); dz.classList.add('drag-over'); };
            dz.ondragleave = () => dz.classList.remove('drag-over');
            dz.ondrop = (e) => {
                e.preventDefault();
                dz.classList.remove('drag-over');
                handleFile(e.dataTransfer.files[0], mode);
            };
            inp.onchange = (e) => handleFile(e.target.files[0], mode);
        }

        // --- CORE LOGIC ---
        function handleFile(f, mode) {
            if(!f || !f.type.startsWith('image/')) return alert("Image files only, please.");
            FILE = f;
            FILE_URL = URL.createObjectURL(f); // Create local preview URL
            
            const sizeStr = (f.size / (1024*1024)).toFixed(2) + " MB";
            if(mode === 'conv') {
                document.getElementById('file-name-conv').textContent = f.name;
                document.getElementById('file-size-conv').textContent = sizeStr;
                showState('conv', 'config');
            } else {
                document.getElementById('file-name-up').textContent = f.name;
                document.getElementById('file-size-up').textContent = sizeStr;
                showState('up', 'config');
            }
        }

        function resetApp(mode) {
            FILE = null;
            FILE_URL = null;
            clearInterval(TIMER);
            document.getElementById(`file-input-${mode}`).value = '';
            showState(mode, 'upload');
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('final-actions').style.display = 'none';
            document.getElementById('compare-wrapper').style.display = 'none';
            document.getElementById('preview-area').style.display = 'none';
        }

        async function startJob(mode) {
            triggerResultView(); // Show shared result view
            startTime = Date.now(); // NEW: Start time tracking

            const fd = new FormData();
            fd.append('file', FILE);
            fd.append('mode', mode); // 'convert' or 'upscale'

            if(mode === 'convert') {
                fd.append('conversion_key', document.getElementById('format-select').value);
                fd.append('settings', JSON.stringify({
                    width: document.getElementById('inp-width').value,
                    height: document.getElementById('inp-height').value,
                    maintain_ar: document.getElementById('check-ar').checked,
                    quality: document.getElementById('inp-quality').value,
                    opacity: document.getElementById('inp-opacity').value
                }));
            } else {
                // Upscale Mode
                fd.append('settings', JSON.stringify({
                    upscale_res: document.getElementById('upscale-res').value
                }));
            }

            try {
                const req = await fetch('/api/jobs', { method:'POST', body:fd });
                const res = await req.json();

                if(!req.ok) throw new Error(res.msg || "Server Error");

                JOB_ID = res.job_id;
                TIMER = setInterval(() => poll(mode), 1000); // Pass mode to poll
            } catch (e) {
                alert("Error: " + e.message);
                window.location.reload();
            }
        }

        async function poll(mode) {
            try {
                const req = await fetch(`/api/status/${JOB_ID}`);
                const res = await req.json();

                const bar = document.getElementById('progress-bar');
                const txt = document.getElementById('status-text');
                const head = document.getElementById('status-head');

                if(res.status === 'running' || res.status === 'queued') {
                    // Make progress move a bit even if backend is stuck (UX)
                    let currentW = parseFloat(bar.style.width) || 0;
                    let visualProgress = Math.max(currentW, res.progress); 
                    
                    if(mode === 'upscale') {
                        // Max out the visual progress bar at 90% during AI processing
                        const maxVisualProgress = 90;
                        
                        if(visualProgress < maxVisualProgress) {
                             // Smoothly animate progress from client-side start time
                            const elapsedSeconds = (Date.now() - startTime) / 1000;
                            // Set a minimum visible progress for UX
                            let timeBasedProgress = Math.min(maxVisualProgress, 10 + (elapsedSeconds * 2.5)); 
                            visualProgress = Math.max(visualProgress, timeBasedProgress);
                        } else {
                            visualProgress = maxVisualProgress;
                        }

                        head.textContent = "AI Image Enhancement in Progress...";
                        if (res.status === 'queued') {
                             txt.textContent = "Waiting for an available AI worker (Low queue priority)...";
                        } else if (res.progress >= 70) {
                             txt.textContent = "AI Enhancement complete. Finalizing output file...";
                        } else {
                             txt.textContent = "AI is Enhancing Details (This may take 10-30 seconds)...";
                        }
                    } else { // Conversion mode
                        head.textContent = "Processing Image Conversion...";
                        txt.textContent = res.status === 'queued' ? "Waiting in queue..." : "Processing pixels...";
                    }
                    
                    bar.style.width = visualProgress + "%";
                } else if (res.status === 'completed') {
                    clearInterval(TIMER);
                    bar.style.width = "100%";
                    document.getElementById('status-head').textContent = "Success!";
                    txt.textContent = "Image processing complete. Download below.";

                    const acts = document.getElementById('final-actions');
                    acts.style.display = 'block';
                    acts.style.opacity = 0;
                    setTimeout(() => acts.style.opacity = 1, 100);

                    const downloadBtn = document.getElementById('btn-download');
                    downloadBtn.href = res.download_url;

                    if (mode === 'upscale') {
                        // Setup Comparison Slider
                        document.getElementById('compare-wrapper').style.display = 'block';
                        document.getElementById('preview-area').style.display = 'none';
                        
                        document.getElementById('comp-before').src = FILE_URL; // Local preview
                        document.getElementById('comp-after').src = res.download_url; // Result from server
                        // Reset slider
                        document.getElementById('comp-slider-input').value = 50;
                        moveSlider(50);
                    } else {
                        // Standard Preview
                        document.getElementById('compare-wrapper').style.display = 'none';
                        const pbox = document.getElementById('preview-area');
                        pbox.style.display = 'block';
                        pbox.innerHTML = `<img src="${res.download_url}" class="preview-img">`;
                    }

                } else if (res.status === 'failed') {
                    clearInterval(TIMER);
                    head.textContent = "Processing Failed!";
                    txt.textContent = `Error: ${res.log || "Unknown processing error."}`;
                    bar.style.width = "100%";
                    bar.style.backgroundColor = 'var(--error)';
                    // Provide a restart button immediately
                    document.getElementById('final-actions').style.display = 'block';
                    document.getElementById('final-actions').innerHTML = `<button class="btn btn-primary" onclick="window.location.reload()">Try Again</button>`;
                }
            } catch(e) { 
                console.error(e);
                clearInterval(TIMER);
                head.textContent = "Connection Error!";
                txt.textContent = `Could not communicate with the server. Please try again.`;
            }
        }

        // Start
        init();
    </script>
</body>
</html>
